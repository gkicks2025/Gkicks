<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Authentication Issue</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
            text-align: center;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .title {
            color: #333;
            margin-bottom: 20px;
        }
        .description {
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .button {
            background: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            background: #0056b3;
        }
        .button.danger {
            background: #dc3545;
        }
        .button.danger:hover {
            background: #c82333;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üîß Fix Authentication Issue</h1>
        <p class="description">
            There's a malformed JWT token in your browser's localStorage that's preventing the wishlist from loading properly from the database. 
            This is causing the wishlist to fall back to localStorage instead of showing the correct images from the database.
        </p>
        
        <div id="status"></div>
        
        <button class="button danger" onclick="clearAuthData()">Clear Authentication Data</button>
        <br><br>
        <a href="/auth" class="button">Go to Login Page</a>
        <a href="/wishlist" class="button">Go to Wishlist</a>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
            <h3>Current Authentication Status:</h3>
            <div id="auth-status" style="font-family: monospace; background: #f8f9fa; padding: 15px; border-radius: 4px; text-align: left;">Loading...</div>
        </div>
    </div>

    <script>
        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }
        
        function clearAuthData() {
            try {
                // Clear all authentication related data
                localStorage.removeItem('auth_token');
                localStorage.removeItem('gkicks-wishlist');
                sessionStorage.clear();
                
                showStatus('‚úÖ Authentication data cleared successfully! Please log in again to fix the wishlist issue.', 'success');
                
                // Update status display
                setTimeout(checkAuthStatus, 500);
                
            } catch (error) {
                showStatus('‚ùå Error clearing data: ' + error.message, 'error');
            }
        }
        
        function checkAuthStatus() {
            const statusDiv = document.getElementById('auth-status');
            const token = localStorage.getItem('auth_token');
            const wishlist = localStorage.getItem('gkicks-wishlist');
            
            let status = '';
            status += `Auth Token: ${token ? 'EXISTS (length: ' + token.length + ')' : 'NOT FOUND'}\n`;
            status += `Wishlist Data: ${wishlist ? 'EXISTS (items: ' + JSON.parse(wishlist).length + ')' : 'NOT FOUND'}\n`;
            
            if (token) {
                try {
                    // Try to decode the JWT payload
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    status += `Token Valid Format: YES\n`;
                    status += `User ID: ${payload.userId || 'N/A'}\n`;
                    status += `Email: ${payload.email || 'N/A'}\n`;
                    status += `Expires: ${payload.exp ? new Date(payload.exp * 1000).toLocaleString() : 'N/A'}\n`;
                } catch (e) {
                    status += `Token Valid Format: NO (${e.message})\n`;
                }
            }
            
            statusDiv.textContent = status;
        }
        
        // Check status on page load
        window.onload = checkAuthStatus;
    </script>
</body>
</html>